# OpenPubkey

## Overview

OpenPubkey allows any OpenID Connect (OIDC)-speaking identity provider to attest to cryptographic public keys alongside identities. This establishes cryptographic signing keys at scale for users and workloads, in a manner that is scalable for workloads and seamless and invisible to users. OpenPubkey does not require any changes to OpenID Connect so it works with today’s OpenID providers.

OpenPubkey works by essentially turning an OpenID Provider (OP) into a Certificate Authority (CA). (A CA is a trusted entity that issues certificates that cryptographically bind an identity with a cryptographic public key.) To do this, OpenPubKey introduces a new cryptographic object — the PK Token — that binds an identity (i.e., a user or a workload) to its public key.

The PK Token and the public key can then be used to enable a myriad of applications. For example:

✍️ [Docker, Inc](https://www.linkedin.com/company/docker/) will use OpenPubKey to sign containers in a public container registry.

☁️ [BastionZero](https://www.linkedin.com/company/bastionzero/) uses OpenPubKey to provide secure remote access to infrastructure.

OpenPubkey is a Linux Foundation project open-sourced under the Apache 2.0 license. This project provides an OpenPubkey client and verifier for creating and verifying PK Tokens from Google’s OP (for users) and GitHub’s OP (for workloads).

## How Does OpenPubkey Work?

Let’s first see how OpenPubkey allows a user, Alice, to use the OP for `acme.com` to bind Alice’s identity `alice@acme.com` to Alice’s public key.  

The standard OpenID Connect protocol has a claim called “nonce,” which encodes a random value generated by Alice’s client. With OIDC, once the client completes its authentication to the OP (which includes generating and sending the nonce, along with the standard single sign-on (SSO) flow of Alice’s username, password, etc.), the OP provides the client with an ID Token that contains the OP’s signature on the nonce claim and on various other claims including the user’s email: `alice@acme.com`.  

In OpenPubkey, Alice runs an OpenPubkey client that first generates a new public-private key pair. Then, when Alice’s client authenticates to the OP, the client sets the nonce claim equal to the cryptographic hash of Alice’s public key along with some random noise. This works because from the perspective of the OP, the output of the cryptographic hash looks just like a random value. Now the ID Token provided by the OP contains the OP’s signature on `alice@acme.com` and on the hash of Alice’s public key. 

The OpenPubkey client can create the PK Token as a JSON Web Signature (JWS) as follows (roughly):
 
  * The ID Token, including the nonce claim, which contains a hash of user’s public key.

  * The user’s public key.

  * The random noise used to compute the hash of the user’s public key.

  * A signature, under the user’s public key, of all the information in the PK Token. (This signature acts as a cryptographic proof that the user has access to the user-held secret signing key that is certified in the PK token.)

The PK Token can be presented to an OpenPubkey verifier, which uses OIDC to obtain the OP’s public key. The verifier validates the ID Token using the OP’s public key and the rest of the claims in the PK Token using the user’s public key.

## Does OpenPubkey Support Workload Identities?

Yes, just like OpenID Connect, OpenPubkey supports both user identities and workload identities.

This means that any OpenID Provider that supports authenticating workloads can also use OpenPubkey to bind a public key to the workload’s identity. For instance, a GitHub Action can sign the software artifact it created under the identity assigned to it by GitHub’s OP.

OpenPubkey for workloads works similarly to how OpenPubkey works for users. One minor difference is that certain OPs (e.g., GitHub’s OP) do not support signing a nonce as part of the OIDC ID Token for workloads. For these OPs, we use the `audience` claim in the ID Token the same way we used the nonce claim described above. Another is the claim in the ID Token used to identify the workload; with Github’s OP, the `actor` or `actoriD` or `job_workflow_ref` could be used, depending on the application.

## How To Use OpenPubkey

OpenPubkey is driven by its use cases. You can find all available use cases in the [examples folder](./examples/). 

We expect this list to continue growing (and if you have an idea for an additional use case, please file an issue, raise the idea in a community meeting, or send a message in our Slack channel)!

## How To Develop With OpenPubkey

As we work to get this repository ready for `v 1.0`, you can check out the [examples folder](./examples/) for more information about OpenPubkey's different use cases. In the meantime, we would love for the community to contribute more use cases. See [below](#get-involved-with-our-community) for guidance on joining our community.

## Governance and Contributing

### File An Issue

For feature requests, bug reports, technical questions and requests, please open an issue. We ask that you review [existing issues](https://github.com/openpubkey/openpubkey/issues) before filing a new one to ensure your issue has not already been addressed. 

If you have found what you believe to be a security vulnerability, *DO NOT file an issue*. Instead, please follow our [security disclosure policy](./SECURITY.md).

### Code Of Conduct
Before contributing to OpenPubkey, please review our [Code of Conduct](./CODE-OF-CONDUCT.md).

### Contribute To OpenPubkey
To learn more about how to contribute, see [CONTRIBUTING.md](./CONTRIBUTING.md).

### Get Involved With Our Community
To get involved with our community, see our [community repo](https://github.com/openpubkey/community/). You’ll find details such as when the next community and technical steering committee meetings are.

### Report A Security Issue
To report a security issue, please follow our [security disclosure policy](./SECURITY.md). 

## FAQ
See the [FAQ](./docs/FAQ.md) for answers to Frequently Asked Questions about OpenPubkey.
